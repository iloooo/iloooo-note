# JWT

## 问题

### A用户关注了B用户的时候，系统发邮件给B用户，并且附有一个链接“点此关注A用户”

- https://your.awesome-app.com/make-friend/?from_user=B&target_user=A

### 上述URL描述存在弊端：前要求用户一定先登录

### 需求：简化这个流程，让B用户不用登录

### 解决

- 添加好友的操作描述成一个JSON对象，载荷

## 概念介绍

### JSON Web Token（JWT）规范

### 使用JWT在用户和服务器之间传递安全可靠的信息

### 头部

- 描述关于该JWT的最基本的信息，例如其类型以及签名所用的算法，JSON对象进行Base64编码后得到的字符串

### 载荷（Payload）

- 描述操作的JSON对象进行Base64编码后得到的字符串
- iss: 该JWT的签发者
- sub: 该JWT所面向的用户
- aud: 接收该JWT的一方
- exp(expires): 什么时候过期，这里是一个Unix时间戳
- iat(issued at): 在什么时候签发的

### 签名

- 头部 . 载荷 拼接后进行加密算法加密
- 目的：

	- 加密算法对于不同的输入产生的输出总是不一样的
	- 服务器应用在接受到JWT后，会首先对头部和载荷的内容用同一算法再次签名，比对传过来的签名
	- 验证信息是否被篡改过
	- 也就是保证：

### 头部

- .

	- 载荷

		- .

			- 签名

## 和Session方式存储id的差异

### Session方式最大弊病在于要占用大量服务器内存，于较大型应用而言可能还要保存许多的状态

### JWT方式将用户状态通过cookie分散到了每个客户端（浏览器）中，可以明显减轻服务端的内存压力。除id之外，还可以存储其他的和用户相关的信息，例如该用户是否是管理员、用户所在的分桶

### 虽说JWT方式让服务器有一些计算压力（例如加密、编码和解码），但是这些压力相比磁盘I/O而言或许是半斤八两

## 参考

### JSON Web Token - 在 Web 应用间安全地传递信息

### 八幅漫画理解使用 JSON Web Token 设计单点登录系统

### 前后端分离 SpringBoot + SpringSecurity + JWT + RBAC 实现用户无状态请求验证

## 登录使用JWT情况

### one-click-login(公司)

- JWT

